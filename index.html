<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quick Quiz App</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #6e8efb, #a777e3);
    color: #fff;
    text-align: center;
    padding: 2rem;
  }
  .container {
    background: #fff;
    color: #333;
    max-width: 500px;
    margin: 0 auto;
    padding: 2rem;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    position: relative;
  }
  .question-counter {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 0.9rem;
    color: #666;
  }
  button {
    padding: 0.7rem 1.5rem;
    margin: 0.5rem;
    border: none;
    border-radius: 5px;
    background: #6e8efb;
    color: #fff;
    cursor: pointer;
  }
  button:hover {
    background: #a777e3;
  }
  .answer {
    display: block;
    margin: 1rem 0;
    padding: 1rem;
    background: #6e8efb;
    color: #fff;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1rem;
  }
  .answer:hover {
    background: #a777e3;
  }
  .correct { background-color: #8bc34a !important; }
  .wrong { background-color: #f44336 !important; }
</style>
<script>
// Force no-cache for index.html reload
if (performance.navigation.type === 1) {
  const url = new URL(window.location.href);
  url.searchParams.set('nocache', Date.now());
  window.history.replaceState(null, '', url);
}
</script>
</head>
<body>
<div class="container">
  <h1>Quick Quiz</h1>
  <div id="chapter-selection">
    <h2>Select Chapter</h2>
    <button onclick="selectChapter(1)">Chapter 1</button>
    <button onclick="selectChapter(2)">Chapter 2</button>
    <button onclick="selectChapter(3)">Chapter 3</button>
  </div>
  
  <div id="quiz" style="display:none">
    <div class="question-counter" id="questionCounter"></div>
    <h2 id="question"></h2>
    <div id="answers"></div>
    <p id="feedback"></p>
    <p>Correct: <span id="correctCount">0</span> | Wrong: <span id="wrongCount">0</span></p>
    <button id="nextBtn" style="display:none" onclick="nextQuestion()">Next Question</button>
    <button id="nextPageBtn" style="display:none" onclick="nextPage()">Next Page</button>
    <br><br>
    <button style="background:#f44336;" onclick="goBack()">Back to Chapters</button>
  </div>
</div>

<script>
let questions = [];
let currentQuestion = 0;
let correctCount = 0;
let wrongCount = 0;
let answered = false;

function parseLine(line) {
  return line.split(';').map(e => e.trim());
}

function selectChapter(chapter) {
  fetch(`chapter${chapter}.csv?nocache=${Date.now()}`)
    .then(response => response.text())
    .then(text => {
      questions = text.trim().split('\n').map(parseLine);
      currentQuestion = 0;
      correctCount = 0;
      wrongCount = 0;
      document.getElementById('chapter-selection').style.display = 'none';
      document.getElementById('quiz').style.display = 'block';
      showQuestion();
    });
}

function showQuestion() {
  if (currentQuestion >= questions.length) {
    document.getElementById('quiz').innerHTML = `<h2>Quiz Finished!</h2><p>Correct: ${correctCount} | Wrong: ${wrongCount}</p><button onclick="location.reload()">Restart</button><br><br><button style='background:#f44336;' onclick="goBack()">Back to Chapters</button>`;
    return;
  }
  document.getElementById('questionCounter').textContent = `${currentQuestion + 1}/${questions.length}`;
  const q = questions[currentQuestion];
  document.getElementById('question').textContent = q[0];
  const answersDiv = document.getElementById('answers');
  answersDiv.innerHTML = '';
  ['A', 'B', 'C'].forEach((option, index) => {
    const btn = document.createElement('button');
    btn.textContent = `${option}: ${q[index + 1]}`;
    btn.className = 'answer';
    btn.onclick = () => checkAnswer(option, btn);
    answersDiv.appendChild(btn);
  });
  document.getElementById('feedback').textContent = '';
  document.getElementById('nextBtn').style.display = 'none';
  document.getElementById('nextPageBtn').style.display = 'none';
  answered = false;
}

function checkAnswer(selected, btn) {
  if (answered) return;
  answered = true;
  const correct = questions[currentQuestion][4].trim();
  if (selected === correct) {
    correctCount++;
    document.getElementById('feedback').textContent = 'Correct!';
    btn.classList.add('correct');
  } else {
    wrongCount++;
    document.getElementById('feedback').textContent = `Wrong! Correct answer: ${correct}`;
    btn.classList.add('wrong');
  }
  document.getElementById('correctCount').textContent = correctCount;
  document.getElementById('wrongCount').textContent = wrongCount;
  document.getElementById('nextBtn').style.display = 'inline-block';
  document.getElementById('nextPageBtn').style.display = 'inline-block';
}

function nextQuestion() {
  currentQuestion++;
  showQuestion();
}

function nextPage() {
  currentQuestion = Math.min(currentQuestion - (currentQuestion % 10) + 10, questions.length);
  showQuestion();
}

function goBack() {
  document.getElementById('quiz').style.display = 'none';
  document.getElementById('chapter-selection').style.display = 'block';
}
</script>
</body>
</html>
